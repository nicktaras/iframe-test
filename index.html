

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	its iframe...
	<div id="logger"></div>
	<script>
		let opener = window.opener;
		let parentWindow;
		let parentURL = document.referrer;

		let pUrl = new URL(parentURL);
		let parentOrigin = pUrl.origin;

		function attachPostMessageListener(listener) {
		    if (window.addEventListener) {
		      window.addEventListener("message", listener, false);
		    } else {
		      // IE8
		      window.attachEvent("onmessage", listener);
		    }
		}
		let listener = (event) => {
			if (event.origin != parentOrigin) return;
			logger.insertAdjacentHTML('beforeend', `<div>child tab received postMessage from parent: ${JSON.stringify(event.data)}</div>`)
			console.log("child tab received postMessage from parent:", event.data);
		}
		attachPostMessageListener(listener);

		setInterval(()=>{

			var hello = localStorage.getItem('hello');

			if (document.referrer) {
	            opener.postMessage({ iframeCommand: "ttt2", iframeData: hello }, parentOrigin);
	        }
		}, 2000);
	</script>
</body>
</html>
		
